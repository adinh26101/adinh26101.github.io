---
title: "UNet: Kiáº¿n trÃºc vÃ  á»¨ng Dá»¥ng trong PhÃ¢n Äoáº¡n áº¢nh"
date: 2025-06-03 10:00:00 +0000
categories: [Machine Learning, Computer Vision]
tags: [UNet, Semantic Segmentation, Deep Learning]
author: adinh26101
icon: fas fa-project-diagram
lang: vi
math: true
permalink: /posts/unet/
---

### Ná»™i dung
- [1. Giá»›i thiá»‡u](#-gioi-thieu)
- [2. Kiáº¿n trÃºc UNet](#-kien-truc)
    - [2.1 Downsampling (Contracting)](#-downsampling)
    - [2.2 Upsampling (Expanding)](#-upsampling)
    - [2.3 Skip Connections](#-skip)
- [3. á»¨ng dá»¥ng UNet](#-ung-dung)
- [4. Æ¯u Ä‘iá»ƒm vÃ  háº¡n cháº¿](#-uu-diem)
- [5. Tham kháº£o](#-tham-khao)

<a name="-gioi-thieu"></a>  
## 1. Giá»›i thiá»‡u

UNet lÃ  kiáº¿n trÃºc máº¡ng nÆ¡-ron tÃ­ch cháº­p chuyÃªn dÃ¹ng cho bÃ i toÃ¡n **phÃ¢n Ä‘oáº¡n áº£nh**, Ä‘áº·c biá»‡t phá»• biáº¿n trong y táº¿ vÃ  viá»…n thÃ¡m. ÄÆ°á»£c giá»›i thiá»‡u bá»Ÿi Olaf Ronneberger nÄƒm 2015, UNet ná»•i báº­t vá»›i kiáº¿n trÃºc Ä‘á»‘i xá»©ng hÃ¬nh chá»¯ "U".

---

<a name="-kien-truc"></a>  
<a name="-kien-truc"></a>  
## 2. Kiáº¿n trÃºc UNet (Cáº­p nháº­t)

UNet lÃ  máº¡ng Ä‘á»‘i xá»©ng hÃ¬nh chá»¯ "U" gá»“m hai giai Ä‘oáº¡n chÃ­nh: downsampling (thu nhá» khÃ´ng gian áº£nh, tÄƒng chiá»u sÃ¢u Ä‘áº·c trÆ°ng) vÃ  upsampling (phá»¥c há»“i láº¡i kÃ­ch thÆ°á»›c áº£nh gá»‘c). Äiá»ƒm ná»•i báº­t cá»§a UNet lÃ  cÃ¡c **skip connections** káº¿t ná»‘i trá»±c tiáº¿p cÃ¡c táº§ng tÆ°Æ¡ng á»©ng giá»¯a hai giai Ä‘oáº¡n, giÃºp báº£o toÃ n thÃ´ng tin khÃ´ng gian vÃ  cáº£i thiá»‡n hiá»‡u quáº£ huáº¥n luyá»‡n.

<p>
    <img src="assets/2025-06-3-unet/unet.png" alt="kiÃªÌn truÌc mÃ´ hiÌ€nh UNet"/>
    <em>kiÃªÌn truÌc mÃ´ hiÌ€nh UNet</em>
</p>

- **Downsampling:** Má»—i bÆ°á»›c gá»“m hai lá»›p convolution (kernel 3x3, padding Ä‘á»ƒ giá»¯ kÃ­ch thÆ°á»›c), kÃ­ch hoáº¡t ReLU, vÃ  lá»›p MaxPooling (2x2) giáº£m kÃ­ch thÆ°á»›c khÃ´ng gian Ä‘i má»™t ná»­a. Qua má»—i bÆ°á»›c, sá»‘ kÃªnh Ä‘áº·c trÆ°ng Ä‘Æ°á»£c tÄƒng lÃªn, giÃºp máº¡ng há»c Ä‘Æ°á»£c cÃ¡c Ä‘áº·c trÆ°ng phá»©c táº¡p hÆ¡n.

- **Upsampling:** DÃ¹ng cÃ¡c lá»›p chuyá»ƒn vá»‹ convolution (ConvTranspose) hoáº·c upsample Ä‘á»ƒ tÄƒng kÃ­ch thÆ°á»›c áº£nh lÃªn gáº¥p Ä‘Ã´i, sau Ä‘Ã³ ghÃ©p (concatenate) vá»›i feature map tÆ°Æ¡ng á»©ng tá»« giai Ä‘oáº¡n downsampling qua skip connection. Tiáº¿p tá»¥c hai lá»›p convolution vÃ  ReLU Ä‘á»ƒ tinh chá»‰nh Ä‘áº·c trÆ°ng trÆ°á»›c khi Ä‘Æ°a sang bÆ°á»›c tiáº¿p theo.

- **Skip Connections:** GiÃºp máº¡ng giá»¯ láº¡i chi tiáº¿t khÃ´ng gian bá»‹ máº¥t trong quÃ¡ trÃ¬nh downsampling, tá»« Ä‘Ã³ cho káº¿t quáº£ phÃ¢n Ä‘oáº¡n chÃ­nh xÃ¡c hÆ¡n, Ä‘áº·c biá»‡t vá»›i cÃ¡c chi tiáº¿t nhá» hoáº·c biÃªn phá»©c táº¡p.

## Giáº£i thÃ­ch kiáº¿n trÃºc U-Net

NhÃ¬n vÃ o hÃ¬nh trÃªn, báº¡n sáº½ tháº¥y mÃ´ hÃ¬nh U-Net cÃ³ hÃ¬nh chá»¯ **"U"** Ä‘Ãºng nhÆ° tÃªn gá»i cá»§a nÃ³. MÃ¬nh sáº½ chia nhá» ra thÃ nh 3 pháº§n chÃ­nh Ä‘á»ƒ giáº£i thÃ­ch cho dá»… hiá»ƒu, sau Ä‘Ã³ miÌ€nh sáº½ nÃ³i vá» **luá»“ng dá»¯ liá»‡u chi tiáº¿t**

---

### ğŸ”» 1. Downsampling â€“ LÃ m áº£nh nhá» láº¡i Ä‘á»ƒ láº¥y Ä‘áº·c trÆ°ng

Pháº§n bÃªn trÃ¡i cá»§a mÃ´ hÃ¬nh lÃ  quÃ¡ trÃ¬nh **nÃ©n áº£nh** láº¡i.

- áº¢nh Ä‘áº§u vÃ o khÃ¡ lá»›n, vÃ­ dá»¥ `572x572x1`.
- Qua 2 lá»›p **Conv 3x3 + ReLU** â†’ giá»¯ gáº§n nguyÃªn kÃ­ch thÆ°á»›c nhÆ°ng sá»‘ kÃªnh tÄƒng (vd: lÃªn `64`).
- Sau Ä‘Ã³ lÃ  **MaxPooling 2x2** (mÅ©i tÃªn Ä‘á») â†’ giáº£m kÃ­ch thÆ°á»›c áº£nh xuá»‘ng cÃ²n má»™t ná»­a, sá»‘ kÃªnh láº¡i tiáº¿p tá»¥c tÄƒng.

Má»—i láº§n nÃ©n, áº£nh **nhá» láº¡i**, nhÆ°ng chiá»u sÃ¢u (sá»‘ kÃªnh) **lá»›n hÆ¡n** â†’ mÃ´ hÃ¬nh há»c Ä‘Æ°á»£c cÃ¡c Ä‘áº·c trÆ°ng quan trá»ng hÆ¡n.

---

### ğŸ”º 2. Upsampling â€“ PhÃ³ng to áº£nh trá»Ÿ láº¡i

Sau khi áº£nh Ä‘Æ°á»£c nÃ©n Ä‘áº¿n má»©c trá»«u tÆ°á»£ng nháº¥t á»Ÿ Ä‘Ã¡y chá»¯ "U", mÃ´ hÃ¬nh báº¯t Ä‘áº§u **giáº£i nÃ©n** dáº§n:

- **Up-conv 2x2** (mÅ©i tÃªn xanh lÃ¡): tÄƒng kÃ­ch thÆ°á»›c áº£nh gáº¥p Ä‘Ã´i.
- **GhÃ©p (copy & crop)** vá»›i áº£nh tá»« bÃªn trÃ¡i cÃ¹ng cáº¥p Ä‘á»™ (mÅ©i tÃªn xÃ¡m) â†’ bá»• sung láº¡i thÃ´ng tin chi tiáº¿t Ä‘Ã£ máº¥t.
- Sau Ä‘Ã³ tiáº¿p tá»¥c 2 lá»›p Conv 3x3 nhÆ° bÃªn trÃ¡i.

Káº¿t quáº£: áº£nh dáº§n Ä‘Æ°á»£c tÃ¡i táº¡o láº¡i, nhÆ°ng váº«n giá»¯ nhá»¯ng Ä‘áº·c trÆ°ng quan trá»ng.

---

### 3. Skip Connections â€“ Cáº§u ná»‘i giá»¯ chi tiáº¿t

CÃ¡c mÅ©i tÃªn ngang mÃ u xÃ¡m chÃ­nh lÃ  **skip connection** â€“ Ä‘Ã³ng vai trÃ² nhÆ° â€œcáº§u ná»‘iâ€.

- ChÃºng truyá»n thÃ´ng tin tá»« pháº§n nÃ©n (trÃ¡i) sang pháº§n giáº£i nÃ©n (pháº£i).
- GiÃºp giá»¯ láº¡i nhá»¯ng chi tiáº¿t quan trá»ng nhÆ° cáº¡nh, Ä‘Æ°á»ng viá»n, biÃªn Ä‘á»‘i tÆ°á»£ng...

Nhá» Ä‘Ã³, mÃ´ hÃ¬nh cÃ³ thá»ƒ vá»«a há»c Ä‘áº·c trÆ°ng tá»•ng thá»ƒ vá»«a giá»¯ Ä‘Æ°á»£c Ä‘á»™ chÃ­nh xÃ¡c á»Ÿ má»©c pixel.

---

## Luá»“ng dá»¯ liá»‡u qua mÃ´ hÃ¬nh U-Net (dá»±a trÃªn hÃ¬nh trÃªn)

Giá» ta xem ká»¹ hÆ¡n **luá»“ng dá»¯ liá»‡u Ä‘i qua mÃ´ hÃ¬nh** â€“ tá»«ng bÆ°á»›c áº£nh Ä‘Æ°á»£c xá»­ lÃ½ nhÆ° tháº¿ nÃ o.

---

### BÆ°á»›c 1: Nháº­p áº£nh
- áº¢nh Ä‘áº§u vÃ o `572x572x1` (áº£nh Ä‘en tráº¯ng).
- Qua 2 lá»›p conv â†’ giá»¯ kÃ­ch thÆ°á»›c gáº§n nhÆ° nguyÃªn, thÃ nh `568x568x64`.

---

### BÆ°á»›c 2: Downsampling â€“ NÃ©n dáº§n
- Pooling 2x2 â†’ `284x284x64`
- Conv x2 â†’ `280x280x128` â†’ pooling â†’ `140x140x128`
- Tiáº¿p tá»¥c:  
  â†’ `138x138x256` â†’ pooling  
  â†’ `68x68x512` â†’ pooling  
  â†’ Ä‘Ã¡y: `28x28x1024`  

Táº¡i Ä‘Ã¡y mÃ´ hÃ¬nh, áº£nh ráº¥t nhá» nhÆ°ng mang Ä‘áº·c trÆ°ng sÃ¢u nháº¥t.

---

### BÆ°á»›c 3: Upsampling â€“ PhÃ³ng to dáº§n
- Upconv â†’ `56x56x512`  
  â†’ ghÃ©p vá»›i feature tá»« bÃªn trÃ¡i â†’ conv x2 â†’ `56x56x512`
- Tiáº¿p tá»¥c:  
  â†’ `104x104x256`  
  â†’ `200x200x128`  
  â†’ `388x388x64`

---

### BÆ°á»›c 4: Káº¿t thÃºc
- Qua conv cuá»‘i cÃ¹ng (1x1) â†’ `388x388x2`  
  â†’ má»—i pixel cÃ³ 2 giÃ¡ trá»‹: xÃ¡c suáº¥t thuá»™c lá»›p nÃ o (foreground/background).

---

## TÃ³m táº¯t kiáº¿n trÃºc U-Net

| Giai Ä‘oáº¡n        | KÃ­ch thÆ°á»›c áº£nh (vÃ­ dá»¥) | Má»¥c Ä‘Ã­ch chÃ­nh                               |
|------------------|-------------------------|-----------------------------------------------|
| Nháº­p áº£nh         | 572x572x1               | Nháº­n áº£nh Ä‘áº§u vÃ o                              |
| Downsampling     | 568â†’284â†’140â†’70â†’34â†’28    | Há»c Ä‘áº·c trÆ°ng trá»«u tÆ°á»£ng, giáº£m kÃ­ch thÆ°á»›c     |
| Bottleneck       | 28x28x1024              | Äáº·c trÆ°ng sÃ¢u nháº¥t                            |
| Upsampling       | 28â†’56â†’104â†’200â†’388       | TÃ¡i táº¡o láº¡i áº£nh + káº¿t há»£p thÃ´ng tin chi tiáº¿t  |
| Output           | 388x388x2               | Báº£n Ä‘á»“ phÃ¢n Ä‘oáº¡n (segmentation map)           |

---

ÄiÃªÌ‰m maÌ£nh cuÌ‰a UNet lÃ :
- Cáº¥u trÃºc Ä‘á»‘i xá»©ng dá»… hiá»ƒu.
- CÃ¡c káº¿t ná»‘i skip giÃºp giá»¯ chi tiáº¿t tá»‘t.
- Dá»… huáº¥n luyá»‡n vÃ  Ä‘áº¡t hiá»‡u quáº£ cao trong phÃ¢n Ä‘oáº¡n áº£nh y táº¿, vá»‡ tinh,...

### ThÆ° viá»‡n há»— trá»£ UNet

[Segmentation Models PyTorch (SMP)](https://smp.readthedocs.io/en/latest/models.html#unet) lÃ  má»™t thÆ° viá»‡n Python ráº¥t tiá»‡n lá»£i Ä‘á»ƒ xÃ¢y dá»±ng vÃ  huáº¥n luyá»‡n cÃ¡c mÃ´ hÃ¬nh phÃ¢n Ä‘oáº¡n áº£nh, trong Ä‘Ã³ cÃ³ UNet. SMP cung cáº¥p cÃ¡c backbone (pháº§n CNN trÃ­ch xuáº¥t Ä‘áº·c trÆ°ng) Ä‘a dáº¡ng, giÃºp cáº£i thiá»‡n hiá»‡u quáº£ mÃ´ hÃ¬nh má»™t cÃ¡ch dá»… dÃ ng.

VÃ­ dá»¥ Ä‘Æ¡n giáº£n sá»­ dá»¥ng UNet vá»›i backbone ResNet:

```python
import segmentation_models_pytorch as smp

model = smp.Unet(
    encoder_name="resnet34",        # backbone CNN
    encoder_weights="imagenet",     # sá»­ dá»¥ng trá»ng sá»‘ há»c sáºµn
    in_channels=3,                  # sá»‘ kÃªnh áº£nh Ä‘áº§u vÃ o (RGB)
    classes=1                       # sá»‘ lá»›p Ä‘áº§u ra (vÃ­ dá»¥: 1 lá»›p cho phÃ¢n Ä‘oáº¡n nhá»‹ phÃ¢n)
)
```

---

<a name="-ung-dung"></a>  
## 3. á»¨ng dá»¥ng UNet

UNet Ä‘Æ°á»£c dÃ¹ng nhiá»u trong cÃ¡c bÃ i toÃ¡n segmentation:
- áº¢nh y táº¿: phÃ¢n vÃ¹ng mÃ´, cÆ¡ quan
- Viá»…n thÃ¡m: phÃ¢n máº£nh Ä‘áº¥t, sÃ´ng, nhÃ 
- Äáº¿m thá»±c thá»ƒ: táº¿ bÃ o, háº¡t giá»‘ng...

---

<a name="-uu-diem"></a>  
## 4. Æ¯u Ä‘iá»ƒm vÃ  háº¡n cháº¿

**Æ¯u Ä‘iá»ƒm:**
- Hoáº¡t Ä‘á»™ng tá»‘t vá»›i Ã­t dá»¯ liá»‡u
- TÃ¡i táº¡o chi tiáº¿t nhá» skip connections
- Kiáº¿n trÃºc Ä‘Æ¡n giáº£n, dá»… má»Ÿ rá»™ng (UNet++, ResUNet,...)

**Háº¡n cháº¿:**
- KÃ­ch thÆ°á»›c áº£nh cá»‘ Ä‘á»‹nh (náº¿u khÃ´ng padding phÃ¹ há»£p)
- CÃ³ thá»ƒ náº·ng RAM vá»›i áº£nh lá»›n

---

<a href="#-tham-khao" name="-tham-khao"></a>  
## 5. Tham kháº£o  
[1] Scikit-learn Developers. *sklearn.metrics.confusion_matrix â€” scikit-learn 1.4.2 documentation*. ğŸ”— [https://scikit-learn.org/stable/modules/generated/sklearn.metrics.confusion_matrix.html](https://scikit-learn.org/stable/modules/generated/sklearn.metrics.confusion_matrix.html)  
[2] Segmentation Models PyTorch. *UNet model documentation*. ğŸ”— [https://smp.readthedocs.io/en/latest/models.html#unet](https://smp.readthedocs.io/en/latest/models.html#unet)